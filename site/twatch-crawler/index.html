<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Crawler - LetsCheck documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Crawler";
        var mkdocs_page_input_path = "twatch-crawler.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> LetsCheck documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../deployment-overview/">Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../letscheck-website/">LetsCheck website</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Twatch</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../twatch/">Application</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Crawler</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#current-status">Current status</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#what-each-file-does">What each file does</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Quin</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../quin-covid/">Quin-COVID</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quin-general/">Quin-general</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../api-request-handling/">API request handling</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">LetsCheck documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Twatch</li>
      <li class="breadcrumb-item active">Crawler</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="twatch-tweet-crawler">Twatch tweet crawler</h1>
<p>This folder contains scripts that download the "dehydrated" version of COVID-19 related tweets from <a href="https://github.com/thepanacealab/covid19_twitter">The Panacea Lab dataset</a>, hydrate them, and store the relevant information in an SQLite database.</p>
<h2 id="current-status">Current status</h2>
<ul>
<li>The dataset has stopped updating as of 15 April 2023.</li>
<li>Below was the old setup on the deprecated A100 machine.</li>
</ul>
<pre><code>- The crawler script is located on A100. The service is managed by `/etc/init.d/tweet-crawler`. To check crawling status, go to `$HOME/logs`.
- The service should always be running; the script itself will sleep for 24 hours after downloading the latest data.
- When the script has finished downloading a new batch of data, an empty file named `new_tweets_available` will be generated. EXALIT searches for this file every day at 2am using a cron job. If new updates are found, EXALIT will copy the Twatch DB from A100 and restart Twatch backend.
- In the event that the `tweet-crawler` service is down, the script `dgx-a100-status-check.sh` on EXALIT should detect it within 20 minutes and restart it. Refer to `misc/dgx-a100-status-check.sh`.
</code></pre>
<h2 id="what-each-file-does">What each file does</h2>
<ul>
<li><code>crawl.sh</code>: sets up &amp; clean up the log folder, calls the Python crawler script, and sleeps for 24 hours before checking for new update again. This script takes care of the entire crawling process and is intended to be used in a systemd service unit file, or other similar service managers.</li>
<li><code>init.sql</code>: the database schema of the output SQLITE database. It should be used in the event of creating a new DB from scratch.</li>
<li><code>last_processed_date</code>: keeps track of what was the latest set of daily tweets downloaded from Panacea Lab repository. Don't delete.</li>
<li><code>processed_chunks</code>: keeps track of which chunk of a single dataset file has been processed. This was meant for big tsv files containing all historical tweets, which were &gt;1GB in size, but is currently still in use, so do not delete.</li>
<li><code>requirements.txt</code>: install required Python packages: <code>pip install -r requirements.txt</code></li>
<li><code>tsv_to_db.py</code>: the main script that does the downloading, processing and storing of processed tweets.</li>
<li><code>tsv_to_postgres_[errors_]log</code>: stores output from <code>tsv_to_db.py</code>. The output database used to be Postgres hence the filename.</li>
<li><code>twitter_auth_info.py</code>: put Twitter API keys here</li>
<li><code>whitelist</code>: tweets from accounts whose handles are found here will not be left out even though they do not get enough likes/retweets. Currently empty but still used in script, so do not delete.</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../twatch/" class="btn btn-neutral float-left" title="Application"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../quin-covid/" class="btn btn-neutral float-right" title="Quin-COVID">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../twatch/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../quin-covid/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
